@{
    ViewData["Title"] = "Ввод показаний счетчика";
}

<h1>@ViewData["Title"]</h1>

<div id="statusMessage" style="margin-bottom:10px;color:green;"></div>

<form id="meterForm">
    <label for="meterNumber">Номер счетчика:</label><br />
    <input type="text" id="meterNumber" name="meterNumber" required /><br /><br />

    <label for="readingDate">Дата:</label><br />
    <input type="date" id="readingDate" name="readingDate" required /><br /><br />

    <label for="readingValue">Показание:</label><br />
    <input type="number" id="readingValue" name="readingValue" required /><br /><br />

    <button type="submit">Отправить</button>
</form>

<script>
const form = document.getElementById('meterForm');
const statusMessage = document.getElementById('statusMessage');
const scriptURL = 'https://script.google.com/macros/s/AKfycby7-ToHy_YNuQ8UxISniVLB9ArQW9cN9pnvMZbAwLlnL4SsGfTKG4JcXYvi_eKhl6ZD/exec';

form.addEventListener('submit', async e => {
    e.preventDefault();
    statusMessage.style.color = 'green';
    statusMessage.textContent = 'Отправка...';

    const formData = new FormData(form);

    try {
        const response = await fetch(scriptURL, { method: 'POST', body: formData });
        const text = await response.text();

        if (response.ok && text.includes('success')) {
            statusMessage.style.color = 'green';
            statusMessage.textContent = '✅ Данные успешно отправлены!';
            form.reset();
        } else {
            statusMessage.style.color = 'red';
            statusMessage.textContent = '❌ Ошибка при отправке. Попробуйте снова.';
            console.error('Ошибка ответа GAS:', text);
        }
    } catch (err) {
        statusMessage.style.color = 'red';
        statusMessage.textContent = '❌ Ошибка при отправке. Попробуйте снова.';
        console.error('Ошибка fetch:', err);
    }

    // Скрыть сообщение через 5 секунд
    setTimeout(() => { statusMessage.textContent = ''; }, 5000);
});
</script>
