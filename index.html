<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Передача показаний</title>
</head>
<body>
    <h2>Форма для передачи показаний</h2>

    <form id="meterForm" target="_blank">
        <label>ФИО или адрес:<br>
            <input type="text" name="name" required>
        </label><br><br>
        <label>Показания:<br>
            <input type="number" name="reading" required>
        </label><br><br>
        <button type="submit">Отправить</button>
    </form>

    <script>
        document.getElementById("meterForm").addEventListener("submit", function (e) {
            // Собираем данные
            const form = e.target;
            const name = form.name.value;
            const reading = form.reading.value;

            // Открываем новое окно
            const popup = window.open('', '_blank');

            // Формируем данные в x-www-form-urlencoded формате
            const formData = new URLSearchParams();
            formData.append("name", name);
            formData.append("reading", reading);

            // Отправляем форму через POST в popup
            const tempForm = document.createElement("form");
            tempForm.method = "POST";
            tempForm.action = "https://script.google.com/macros/s/AKfycbxfrZH25NpFPXp_QhDajcTJb6crVISiXm2A5zdbEdUrHdz7Wis8m5nrAH40NATCagOz/exec";
            tempForm.target = popup.name;

            // Добавляем скрытые input'ы
            for (const [key, value] of formData.entries()) {
                const input = document.createElement("input");
                input.type = "hidden";
                input.name = key;
                input.value = value;
                tempForm.appendChild(input);
            }

            document.body.appendChild(tempForm);
            tempForm.submit();
            document.body.removeChild(tempForm);

            // Сброс основной формы
            form.reset();
        });
    </script>
</body>
</html>
